<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Game Controller</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #222;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* Prevent scrolling */
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            min-width: 32px;
            min-height: 18px;
            height: auto;
            width: 100%;
            transform-origin: top left;
            aspect-ratio: 16 / 9;
        }
        .thumbstick {
            position: absolute;
            width: 18.75%;
            height: 33%;
            background-color: #444;
            border-radius: 50%;
            touch-action: none;
        }
        .thumbstick-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            background-color: #888;
            border-radius: 50%;
        }
        .left-thumbstick {
            left: 25%;
            top: 65%;
            transform: translate(-50%, -50%);
        }
        .right-thumbstick {
            right: 25%;
            top: 65%;
            transform: translate(50%, -50%);
        }
        button {
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            font-size: 3vw;
        }
        .a {
            position: absolute;
            right: 30%; /* Move right by another 50px */
            top: 30%;
            transform: translate(50%, -50%);
            width: 15%;
            height: 26.6%;
            background-color: #55F;
            border: none;
            border-radius: 50%;
            color: #fff;
        }
        .b {
            position: absolute;
            right: 10%; /* Move right by another 50px */
            top: 20%;
            transform: translate(50%, -50%);
            width: 15%;
            height: 26.6%;
            background-color: #F55;
            border: none;
            border-radius: 50%;
            color: #fff;
        }
        .start-button {
            position: absolute;
            top: 40%;
            left: 50%;
            width: 20%;
            height: 15%;
            background-color: #555;
            border: none;
            border-radius: 10px;
            color: #fff;
            justify-content: center;
            align-items: center;
            transform: translateX(-50%);

        }
        .disconnect-button {
            position: absolute;
            top: 10%;
            left: 5%;
            width: 20%;
            height: 15%;
            background-color: #555;
            border: none;
            border-radius: 10px;
            color: #fff;

        }
    </style>
</head>
<body>
    <div class="container">
         <div class="thumbstick left-thumbstick" id="left-thumbstick">
            <div class="thumbstick-inner" id="left-thumbstick-inner"></div>
        </div>
        <div class="thumbstick right-thumbstick" id="right-thumbstick">
            <div class="thumbstick-inner" id="right-thumbstick-inner"></div>
        </div>
        <button class="a">A</button>      
        <button class="b">B</button>
        <button class="start-button">Start</button>
        <button class="disconnect-button">Disconnect</button>
    </div>
    <script>
        const createThumbstick = (thumbstickId, thumbstickInnerId) => {
            const thumbstick = document.getElementById(thumbstickId);
            const thumbstickInner = document.getElementById(thumbstickInnerId);
            let activeTouchId = null;
            let startX, startY;

            const start = (x, y, id) => {
                activeTouchId = id;
                startX = x;
                startY = y;
            };

        const move = (x, y) => {
            if (activeTouchId === null) return;
            const deltaX = x - startX;
            const deltaY = y - startY;

            // Calculate the max distance as a fraction of the viewport width (e.g., 5% of the viewport width)
            const maxDistance = window.innerWidth * 0.05; // Adjust 0.05 (5%) to your preference
            const distance = Math.min(Math.sqrt(deltaX * deltaX + deltaY * deltaY), maxDistance);

            const angle = Math.atan2(deltaY, deltaX);
            const moveX = distance * Math.cos(angle);
            const moveY = distance * Math.sin(angle);

            thumbstickInner.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;
        };


            const end = (id) => {
                if (activeTouchId !== id) return;
                activeTouchId = null;
                thumbstickInner.style.transform = 'translate(-50%, -50%)';
            };

            thumbstick.addEventListener('touchstart', (e) => {
                for (let touch of e.changedTouches) {
                    if (activeTouchId === null) {
                        start(touch.clientX, touch.clientY, touch.identifier);
                    }
                }
            });

            thumbstick.addEventListener('touchmove', (e) => {
                for (let touch of e.changedTouches) {
                    if (touch.identifier === activeTouchId) {
                        move(touch.clientX, touch.clientY);
                    }
                }
            });

            thumbstick.addEventListener('touchend', (e) => {
                for (let touch of e.changedTouches) {
                    end(touch.identifier);
                }
            });

            thumbstick.addEventListener('mousedown', (e) => {
                start(e.clientX, e.clientY, 'mouse');
            });

            document.addEventListener('mousemove', (e) => {
                if (activeTouchId === 'mouse') {
                    move(e.clientX, e.clientY);
                }
            });

            document.addEventListener('mouseup', () => {
                end('mouse');
            });
        };

        createThumbstick('left-thumbstick', 'left-thumbstick-inner');
        createThumbstick('right-thumbstick', 'right-thumbstick-inner');
    </script>
</body>
</html>